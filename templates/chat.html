<!DOCTYPE html>
<html>
    {% extends "layout.html" %}
    <head>
        <title>chat</title>
    </head>
    {% block content %}
    <body>
        <div id="chat-box" style="border: 1px solid #ccc; height: 300px; overflow-y: scroll;">
            <form id="message-form">
                <input type="text" id="message-input" placeholder="Type a message" autocomplete="off" required>
                <button type="submit">Send</button>
            </form>
            {% for message in messages %}
            {{ message[0] }}: {{ message[1] }}
            <br>
            {% endfor %}
        </div>
        {% endblock %}
        {% block scripts %}
        <script type="text/javascript" charset="utf-8">
            document.addEventListener("DOMContentLoaded", function() {

                socket.emit('join', { room_id: "{{ id }}"});

                socket.on('join-confirmation', function(data) {
                    console.log(data.msg);
                });

                socket.on('receive-message', function(data) {
                    var chatBox = document.getElementById("chat-box");
                    var message = document.createElement("p");
                    message.textContent = data.username + ": " + data.message;
                    chatBox.appendChild(message);
                });

                document.getElementById("message-form").onsubmit = function(event) {
                    event.preventDefault();
                    var messageInput = document.getElementById("message-input");
                    var messageText = messageInput.value;

                    socket.emit('send-message', {
                        room_id: "{{ id }}",
                        message: messageText
                    });

                    messageInput.value = "";
                };
            });
        </script>
        {% endblock %}
    </body>
</html>
